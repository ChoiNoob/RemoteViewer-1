package com.damintsev.client.uiframe;

import com.damintsev.client.devices.CommonDevice;
import com.damintsev.client.devices.Station;
import com.damintsev.client.devices.enums.DeviceType;
import com.damintsev.utils.Dialogs;
import com.google.gwt.core.client.GWT;
import com.google.gwt.editor.client.Editor;
import com.google.gwt.editor.client.SimpleBeanEditorDriver;
import com.sencha.gxt.cell.core.client.form.ComboBoxCell;
import com.sencha.gxt.data.shared.LabelProvider;
import com.sencha.gxt.widget.core.client.ContentPanel;
import com.sencha.gxt.widget.core.client.Window;
import com.sencha.gxt.widget.core.client.button.TextButton;
import com.sencha.gxt.widget.core.client.container.VerticalLayoutContainer;
import com.sencha.gxt.widget.core.client.event.SelectEvent;
import com.sencha.gxt.widget.core.client.form.FieldLabel;
import com.sencha.gxt.widget.core.client.form.SimpleComboBox;
import com.sencha.gxt.widget.core.client.form.TextArea;
import com.sencha.gxt.widget.core.client.form.TextField;

/**
 * User: Damintsev Andrey
 * Date: 06.08.13
 * Time: 1:40
 */
public class AddDeviceWindow implements Editor<CommonDevice>{

    private static AddDeviceWindow instance;

    public static AddDeviceWindow get() {
        if(instance == null) instance = new AddDeviceWindow();
        return instance;
    }

    private CommonDevice device;
    private Driver driver = GWT.create(Driver.class);
    private Window window;
    //editor fields
    private TextField name;
    private TextField host;
    private TextField port;
    private TextField login;
    private TextField password;
    private TextArea comment;

    private AddDeviceWindow() {
//        station = new Station();
        window = new Window();
        window.setModal(true);
        window.setPixelSize(350, 350);
        window.setHeadingText("–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç—Ä–∞–Ω–∫");
        ContentPanel con = new ContentPanel();
        con.setHeaderVisible(false);
        con.setBodyStyle("padding: 5px");
        final VerticalLayoutContainer panel = new VerticalLayoutContainer();
        con.add(panel);
        
        final SimpleComboBox<Station> stations = new SimpleComboBox<Station>(new LabelProvider<Station>() {
            public String getLabel(Station item) {
                return item.getName()==null?"–ê–¥—Ä–µ—Å: " + item.getHost():item.getName() + " (" + item.getHost() + ")";
            }
        });
        for(Station station : UICenterField.get().getStations()) {
            stations.add(station);
        }
        stations.setTriggerAction(ComboBoxCell.TriggerAction.ALL);
        stations.setEditable(false);
        stations.setAllowBlank(false);

        panel.add(new FieldLabel(stations, "–°—Ç–∞–Ω—Ü–∏—è"), new VerticalLayoutContainer.VerticalLayoutData(1,-1));

        SimpleComboBox<DeviceType> deviceType = new SimpleComboBox<DeviceType>(new LabelProvider<DeviceType>() {
            public String getLabel(DeviceType item) {
                return item.name();
            }
        });
        deviceType.add(DeviceType.IP);
        deviceType.add(DeviceType.ISDN);
        deviceType.setTriggerAction(ComboBoxCell.TriggerAction.ALL);
        deviceType.setEditable(false);

        panel.add(new FieldLabel(deviceType, "–¢–∏–ø"), new VerticalLayoutContainer.VerticalLayoutData(1,-1));

        name = new TextField();
        panel.add(new FieldLabel(name, "–?–º—è"), new VerticalLayoutContainer.VerticalLayoutData(1,-1));

        host = new TextField();
        host.setAllowBlank(false);
        panel.add(new FieldLabel(host, "–°—Ç—Ä–æ–∫–∞ –∑–∞–ø—Ä–æ—Å–∞"), new VerticalLayoutContainer.VerticalLayoutData(1,-1));

        port = new TextField();
        port.setAllowBlank(false);
        panel.add(new FieldLabel(port, "–ü–æ—Ä—Ç"), new VerticalLayoutContainer.VerticalLayoutData(1,-1));

        login = new TextField();
        panel.add(new FieldLabel(login, "–õ–æ–≥–∏–Ω"), new VerticalLayoutContainer.VerticalLayoutData(1,-1));
        password = new TextField();
        panel.add(new FieldLabel(password, "–ü–∞—Ä–æ–ª—å"), new VerticalLayoutContainer.VerticalLayoutData(1,-1));

        comment = new TextArea();
        comment.setHeight(70);
        panel.add(new FieldLabel(comment, "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"), new VerticalLayoutContainer.VerticalLayoutData(1, -1));

        con.addButton(new TextButton("–°–æ—Ö—Ä–∞–Ω–∏—Ç—å", new SelectEvent.SelectHandler() {
            public void onSelect(SelectEvent event) {

                driver.flush();
//                Station sss = driver.flush();
//                Dialogs.alert("host=" + sss.getHost());
//                Dialogs.alert("port=" + sss.getPort());
            }
        }));

        con.addButton(new TextButton("–û—Ç–º–µ–Ω–∞", new SelectEvent.SelectHandler() {
            public void onSelect(SelectEvent event) {
                window.hide();
            }
        }));

        driver.initialize(this);

        window.setWidget(con);
    }

    public void show(CommonDevice station) {
        if(station.getId() == null) {
          device = new CommonDevice();
        }
        this.device = device;
        driver.edit(device);
        window.show();
    }

    interface Driver extends SimpleBeanEditorDriver<CommonDevice, AddDeviceWindow> {

    }
}
